angular.module("nzToggle",[]).directive("nzToggle",["$timeout",function(M){return{restrict:"E",replace:!0,scope:{config:"=?",ngModel:"=",onToggle:"&",ngDisabled:"="},template:['<div class="nz-toggle-wrap" ng-class="getStyle()" ng-style="wrapStyle">','   <div class="nz-toggle">','       <div class="nz-toggle-handle"></div>',"   </div>",'   <div class="nz-toggle-tooltip" ng-show="tooltip">',"       <span ng-class=\"{'active': showTooltip1}\">",'           <span ng-show="tipFalse"></span>{{tipFalse}}',"       </span>",'       <br ng-show="vertical">','       <span ng-class="{\'active\': showTooltip2}" ng-show="triToggle">','           <span ng-show="tipNull"></span>{{tipNull}}',"       </span>",'       <br ng-show="vertical">',"       <span ng-class=\"{'active': showTooltip3}\">",'           <span ng-show="tipTrue"></span>{{tipTrue}}',"       </span>","   </div>","</div>"].join(""),link:function(l,n,t){var i,r,u,s,g=angular.element(n[0].querySelector(".nz-toggle-handle")),c=0,p={horizontal:{false:0,null:50,true:100},vertical:{false:100,null:50,true:0}},o=angular.isDefined,a=(angular.copy,{vertical:!1,valTrue:!0,valFalse:!1,valNull:null,width:50,height:25,padding:3,colorTrue:null,colorFalse:null,colorNull:null,tooltip:!1}),d=l;function v(l){c<1&&e()}function h(l){if(!d.ngDisabled)return l=l||window.event,i={x:l.pageX||l.touches[0].pageX,y:l.pageY||l.touches[0].pageY},c=0,g.css("transition","0s"),T(window,"mousemove touchmove",f),T(window,"mouseup touchend",w),l.stopPropagation(),l.returnValue=!1}function f(l){var e=((l=l||window.event).pageY||l.touches[0].pageY)-i.y,t=(l.pageX||l.touches[0].pageX)-i.x,o=e/(n[0].offsetHeight/2)*100,a=t/(n[0].offsetWidth/2)*100;return d.vertical?(r=parseFloat(p.vertical[d.state]),u=Math.max(Math.min(parseFloat(o+r),100),0),s=r+(u-r)/2,g.css("top",s+"%")):(r=parseFloat(p.horizontal[d.state]),u=Math.max(Math.min(parseFloat(a+r),100),0),s=r+(u-r)/2,g.css("left",s+"%")),c=Math.max(c,Math.max(Math.abs(e),Math.abs(t))),l.stopPropagation(),l.returnValue=!1}function w(l){return l=l||window.event,i=!1,d.$apply(function(){if(!(c<1&&"mouseup"==l.type)){if(!(c<1&&"touchend"==l.type))return d.triToggle?d.vertical?73<u?void e("false"):27<u?void e("null"):void e("true"):u<27?void e("false"):u<73?void e("null"):void e("true"):d.vertical?50<u?void e("false"):void e("true"):void e(u<50?"false":"true");e()}}),g.css({top:"",left:"",transition:""}),m(window,"mousemove touchmove",f),m(window,"mouseup touchend",w),l.stopPropagation(),l.returnValue=!1}function e(l){d.ngDisabled||M(function(){if(l){if("false"===(d.state=l))return void(d.ngModel=d.valFalse);if("null"===l)return void(d.ngModel=d.valNull);d.ngModel=d.valTrue}else{if("false"==d.state)return void(d.ngModel=d.triToggle?d.valNull:d.valTrue);if("null"==d.state)return void(d.ngModel=d.valTrue);d.ngModel=d.valFalse}})}function T(l,e,t){for(var o=e.split(" "),a=0,n=o.length;a<n;a++)l.addEventListener(o[a],t,!1)}function m(l,e,t){for(var o=e.split(" "),a=0,n=o.length;a<n;a++)l.removeEventListener(o[a],t,!1)}angular.extend(d,{getStyle:function(){return[d.vertical?"vertical":"horizontal",d.state]},toggle:e}),function(){(function(){angular.extend(d,a,d.config||{}),o(t.triToggle)&&(d.triToggle=!0);angular.forEach(["valDefault","valTrue","valFalse","valNull","width","height","colorFalse","colorNull","colorTrue"],function(l){o(t[l])&&(d[l]=d.$eval(t[l]))}),angular.forEach(["tipTrue","tipFalse","tipNull"],function(e){o(t[e])&&d.$watch(t[e],function(l){d[e]=l})}),(d.tipTrue||t.tipFalse||t.tipNull)&&(d.tooltip=!0);{var l;o(t.vertical)&&(d.vertical=!0,d.tooltip&&(l=d.tipTrue,d.tipTrue=d.tipFalse,d.tipFalse=l),d.$eval(t.width)||d.$eval(t.width)||d.config&&(d.config.width||d.config.height)||(l=d.width,d.width=d.height,d.height=l))}d.wrapStyle={width:d.width+"px",height:d.height+"px"},o(d.outerRadius)||(d.outerRadius=Math.min(d.width,d.height)/2);d.innerRadius=d.outerRadius-d.padding})(),o(d.ngModel)||(o(d.valDefault)?d.ngModel=d.valDefault:d.triToggle?d.ngModel=d.valNull:d.ngModel=d.valFalse);var e=!0;d.$watch("ngModel",function(){var l;!function(){if(d.showTooltip1=!1,d.showTooltip2=!1,d.showTooltip3=!1,angular.equals(d.ngModel,d.valTrue))return null!=d.colorTrue&&(d.wrapStyle.backgroundColor=d.colorTrue),d.state="true",d.vertical?d.showTooltip1=!0:d.showTooltip3=!0;if(angular.equals(d.ngModel,d.valFalse))return d.state="false",null!=d.colorFalse&&(d.wrapStyle.backgroundColor=d.colorFalse),d.vertical?d.showTooltip3=!0:d.showTooltip1=!0;d.state="null",null!=d.colorNull&&(d.wrapStyle.backgroundColor=d.colorNull);d.showTooltip2=!0}(),e?e=!1:!d.onToggle.call||(l=d.onToggle())&&l.call&&l(d.ngModel)},!0),T(n[0],"mousedown touchstart",h),T(n[0],"click",v),d.$on("$destroy",function(){m(n[0],"mousedown touchstart",h),m(window,"mousemove touchmove",f),m(window,"mouseup touchend",w),m(n[0],"click",v)})}()}}}]);